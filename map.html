<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MeetMate - íšŒì˜ ì¥ì†Œ</title>
    <script
      async
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCnAjSAFmvjN1cMI8DHKqz6kht2nLA4kys&libraries=places&callback=initMap"
    ></script>
    <link rel="stylesheet" href="meetmate.css" />
    <script src="meetmate.js"></script>
    <style>
      .content {
        align-items: center;
        justify-content: center;
        top: 100px;
        flex: 1;
        padding: 48px;
        max-width: 800px;
        margin-right: 315px;
        min-height: calc(100vh - 80px);
      }
      .main-container {
        display: flex;
        justify-content: center;
      }

      .content h2 {
        font-size: 22px;
        font-weight: 600;
        margin-bottom: 8px;
        text-align: center;
      }

      .intro {
        text-align: center;
        font-size: 15px;
        color: #666;
        margin-bottom: 32px;
      }

      .meeting-card {
        text-align: center;
        background: #fff;
        border-radius: 12px;
        padding: 30px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
      }

      .meeting-option label {
        margin-right: 16px;
        font-size: 16px;
      }

      #map {
        width: 100%;
        height: 400px;
        margin-top: 16px;
        display: none;
        border: 1px solid #ccc;
        border-radius: 8px;
      }

      .zoom-actions {
        display: none;
        margin-top: 16px;
      }

      .zoom-actions input {
        width: 100%;
        padding: 10px;
        margin-top: 8px;
        border: 1px solid #ccc;
        border-radius: 6px;
      }

      .tip-card {
        background: #eaf4ff;
        border-left: 4px solid #4f91ff;
        padding: 16px;
        border-radius: 8px;
        font-size: 14px;
        color: #3366cc;
        margin-top: 32px;
      }
    </style>
  </head>
  <body>
    <header>
      <h1>
        <a href="main-home.html" style="text-decoration: none; color: inherit"
          >MeetMate</a
        >
      </h1>
      <nav class="topnav">
        <ul>
          <li>
            <a href="group.html">ì¼ì • ì¡°ìœ¨</a>
          </li>
          <li>
            <a href="program.html">ì—­í•  ë¶„ë‹´</a>
          </li>
          <li class="active">
            <a href="map.html">íšŒì˜ ì¥ì†Œ</a>
          </li>
          <li>
            <a href="file-share.html">ìë£Œ ê³µìœ </a>
          </li>
          <li>
            <a href="group-result.html">ì „ì²´ ìš”ì•½</a>
          </li>
        </ul>
      </nav>
      <div class="top-buttons" id="auth-buttons"></div>
    </header>

    <div class="main-container">
      <div class="content">
        <h2>íšŒì˜ ì¥ì†Œ ì„¤ì •</h2>
        <p class="intro">
          ì›í•˜ëŠ” íšŒì˜ ë°©ì‹ì„ ì„ íƒí•˜ê³ , íšŒì˜ ì°¸ì—¬ ë˜ëŠ” ì¥ì†Œë¥¼ ì‰½ê²Œ ì„¤ì •í•˜ì„¸ìš”.
        </p>

        <div class="meeting-card">
          <div class="meeting-option">
            <p><strong>íšŒì˜ ë°©ì‹ ì„ íƒ</strong></p>
<label><input type="radio" name="meetingType" id="offline" value="offline"> ëŒ€ë©´</label>
<label><input type="radio" name="meetingType" value="online"> ë¹„ëŒ€ë©´</label>

<!-- ëŒ€ë©´ ì„ íƒ ì‹œ ë³´ì—¬ì§ˆ ê²€ìƒ‰ + ì§€ë„ ì˜ì—­ -->
<div id="offline-options" style="display: none; margin-top: 20px;">
  <!-- ê²€ìƒ‰ì°½ + ë²„íŠ¼ -->
  <div style="display: flex; gap: 8px; margin-bottom: 12px;">
    <input
      type="text"
      id="place-input"
      placeholder="ì¥ì†Œë¥¼ ê²€ìƒ‰í•´ë³´ì„¸ìš” (ì˜ˆ: ìŠ¤í„°ë””ì¹´í˜)"
      style="flex: 1; padding: 8px;"
    />
    <button id="search-btn" style="padding: 8px 16px;">ê²€ìƒ‰</button>
  </div>

  <!-- ì§€ë„ -->
  <div id="map" style="width: 100%; height: 400px;"></div>

  <!-- ì„ íƒëœ ì¥ì†Œ ì •ë³´ + ì €ì¥ ë²„íŠ¼ -->
  <div
    id="place-details"
    style="display: none; margin-top: 16px; padding: 12px; background: #f9f9f9; border: 1px solid #ddd; border-radius: 8px;"
  >
    <p><strong>ì„ íƒí•œ ì¥ì†Œ:</strong> <span id="place-name">-</span></p>
    <p><strong>ì£¼ì†Œ:</strong> <span id="place-address">-</span></p>
    <button id="save-place-btn" style="margin-top: 8px;">ì´ ì¥ì†Œë¡œ ê²°ì •</button>
  </div>
</div>

          </div>

          <!-- Zoom ì „ìš© ê¸°ëŠ¥ -->
          <div class="zoom-actions" id="zoomActions">
            <button class="primary" onclick="openZoomCreation()">
              â• Zoom íšŒì˜ë°© ë§Œë“¤ê¸°
            </button>
            <button class="primary" onclick="showJoinSection()">
              ğŸ”— Zoom íšŒì˜ë°© ì°¸ì—¬í•˜ê¸°
            </button>

            <div id="zoomJoinSection" style="margin-top: 12px; display: none">
              <input
                type="text"
                id="zoomJoinLink"
                placeholder="Zoom íšŒì˜ ë§í¬ ì…ë ¥"
              />
              <button
                class="primary"
                style="margin-top: 8px"
                onclick="joinZoomMeeting()"
              >
                ğŸ“ íšŒì˜ ì°¸ì—¬
              </button>
            </div>
          </div>

          <div id="map">
        </div>

        <div class="tip-card">
          <strong>ğŸ“Œ TIP</strong><br />
          - Zoomì€ ë¡œê·¸ì¸ ìƒíƒœì—ì„œ ì´ìš©í•˜ë©´ ë” í¸ë¦¬í•´ìš”.<br />
          - ëŒ€ë©´ íšŒì˜ëŠ” ìŠ¤í„°ë””ì¹´í˜, ë„ì„œê´€ ë“± ì›í•˜ëŠ” ì¥ì†Œë¥¼ ì§ì ‘ ì„ íƒí•  ìˆ˜
          ìˆì–´ìš”.<br />
          - ìœ„ì¹˜ ê¶Œí•œì„ í—ˆìš©í•˜ë©´ ì£¼ë³€ ì¥ì†Œ ê²€ìƒ‰ì´ ë” ì •í™•í•´ì ¸ìš”.
        </div>
      </div>

      <div class="side-panel">
        <div class="card">
          <div id="today-date">ğŸ“… ì˜¤ëŠ˜ ë‚ ì§œ: -</div>
          <div id="current-time">ğŸ•’ í˜„ì¬ ì‹œê°„: -</div>
        </div>
        <div class="card motivation">
          ğŸ©¶ ì˜¤ëŠ˜ë„ ì¢‹ì€ í•˜ë£¨ ë˜ì„¸ìš”!<br />í•¨ê»˜í•˜ëŠ” ì¼ì •ì€ ë” ì†Œì¤‘í•´ìš”.
        </div>
      </div>
    </div>

    <script>
      document
        .querySelectorAll('input[name="meetingType"]')
        .forEach((radio) => {
          radio.addEventListener("change", function () {
            const zoomBox = document.getElementById("zoomActions");
            const mapEl = document.getElementById("map");

            if (this.value === "online") {
              zoomBox.style.display = "block";
              mapEl.style.display = "none";
              localStorage.setItem("meetingLocation", "ğŸ’» ë¹„ëŒ€ë©´ íšŒì˜ (Zoom)");
            } else {
              zoomBox.style.display = "none";
              mapEl.style.display = "block";
              localStorage.setItem(
                "meetingLocation",
                "ğŸ“ ëŒ€ë©´ íšŒì˜ (ìŠ¤í„°ë””ì¹´í˜)"
              );
              initMap();
            }
          });
        });

      // ì§€ë„ ë¡œë”©
      function initMap() {
        const map = new google.maps.Map(document.getElementById("map"), {
          center: { lat: 37.5665, lng: 126.978 },
          zoom: 14,
        });

        const service = new google.maps.places.PlacesService(map);
        service.nearbySearch(
          {
            location: map.getCenter(),
            radius: 1500,
            keyword: "ìŠ¤í„°ë””ì¹´í˜",
          },
          (results, status) => {
            if (status === google.maps.places.PlacesServiceStatus.OK) {
              results.forEach((place) => {
                const marker = new google.maps.Marker({
                  map,
                  position: place.geometry.location,
                  title: place.name,
                });

                marker.addListener("click", () => {
                  const summary = `ğŸ“ ${place.name} - ${place.vicinity}`;
                  localStorage.setItem("meetingLocation", summary);
                  alert("íšŒì˜ ì¥ì†Œê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤:\n" + summary);
                });
              });
            }
          }
        );
      }

      function openZoomCreation() {
        window.open("https://zoom.us/start/videomeeting", "_blank");
      }

      function showJoinSection() {
        document.getElementById("zoomJoinSection").style.display = "block";
      }

      function joinZoomMeeting() {
        const link = document.getElementById("zoomJoinLink").value.trim();
        if (!link.startsWith("http")) {
          alert("ìœ íš¨í•œ Zoom íšŒì˜ ë§í¬ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
          return;
        }
        const summary = "ğŸ’» Zoom íšŒì˜ ë§í¬: " + link;
        localStorage.setItem("meetingLocation", summary);
        alert("Zoom ë§í¬ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤:\n" + summary);
        window.open(link, "_blank");
      }
      const username = localStorage.getItem("user");
      const topArea = document.getElementById("auth-buttons");

      if (username && username !== "null") {
        topArea.innerHTML = `
      <span>${username}ë‹˜ í™˜ì˜í•©ë‹ˆë‹¤</span>
      <button onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
    `;
      } else {
        topArea.innerHTML = `
      <button onclick="window.location.href='login.html'">ë¡œê·¸ì¸</button>
    `;
      }

      function logout() {
        localStorage.removeItem("user");
        location.reload();
      }
  // ì „ì—­ ë³€ìˆ˜
  let map;
  let markers = [];
  let service;

  function initMapAndSearch(keyword = "ìŠ¤í„°ë””ì¹´í˜") {
    const center = { lat: 37.5665, lng: 126.978 };
    map = new google.maps.Map(document.getElementById("map"), {
      center,
      zoom: 14,
    });

    service = new google.maps.places.PlacesService(map);
    searchPlaces(keyword);
  }

  function searchPlaces(keyword) {
    if (!service) return;

    const request = {
      location: map.getCenter(),
      radius: 1500,
      keyword,
    };

    service.nearbySearch(request, (results, status) => {
      if (status === google.maps.places.PlacesServiceStatus.OK) {
        clearMarkers();
        results.forEach((place) => {
          const marker = new google.maps.Marker({
            map,
            position: place.geometry.location,
            title: place.name,
          });

          marker.addListener("click", () => {
            localStorage.setItem(
              "selectedMeetingPlace",
              JSON.stringify({
                name: place.name,
                address: place.vicinity || place.formatted_address,
              })
            );
            alert(`${place.name} ì¥ì†Œê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.`);
          });

          markers.push(marker);
        });
      }
    });
  }

  function clearMarkers() {
    markers.forEach((m) => m.setMap(null));
    markers = [];
  }

  // ëŒ€ë©´ ì„ íƒ ì‹œ ì§€ë„ ë³´ì´ê¸°
  function onSelectOfflineMeeting() {
    document.getElementById("offline-options").style.display = "block";
    initMapAndSearch();
  }

  document.addEventListener("DOMContentLoaded", () => {
  // "ëŒ€ë©´" ì„ íƒ ì‹œ ì§€ë„ ë³´ì´ê¸°
  document
    .getElementById("offline")
    .addEventListener("change", onSelectOfflineMeeting);
    document.getElementById("save-place-btn").addEventListener("click", () => {
    if (selectedPlace) {
      localStorage.setItem("selectedMeetingPlace", JSON.stringify(selectedPlace));
      alert(`${selectedPlace.name}' ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!`);
    }
  });

  // ì—”í„° ì…ë ¥ ì‹œ ê²€ìƒ‰
  document
    .getElementById("place-input")
    .addEventListener("keypress", (e) => {
      if (e.key === "Enter") {
        searchPlaces(e.target.value);
      }
    });

  // ê²€ìƒ‰ ë²„íŠ¼ í´ë¦­ ì‹œ ê²€ìƒ‰
  document
    .getElementById("search-btn")
    .addEventListener("click", () => {
      const keyword = document.getElementById("place-input").value.trim();
      if (keyword) searchPlaces(keyword);
    });
});
let selectedPlace = null; // í˜„ì¬ ì„ íƒëœ ì¥ì†Œ ì €ì¥ìš©

function searchPlaces(keyword) {
  if (!service) return;

  const request = {
    location: map.getCenter(),
    radius: 1500,
    keyword,
  };

  service.nearbySearch(request, (results, status) => {
    if (status === google.maps.places.PlacesServiceStatus.OK) {
      clearMarkers();
      results.forEach((place) => {
        const marker = new google.maps.Marker({
          map,
          position: place.geometry.location,
          title: place.name,
        });

        marker.addListener("click", () => {
          selectedPlace = {
            name: place.name,
            address: place.vicinity || place.formatted_address,
          };

          // ìƒì„¸ ì •ë³´ í‘œì‹œ
          document.getElementById("place-name").textContent = selectedPlace.name;
          document.getElementById("place-address").textContent = selectedPlace.address;
          document.getElementById("place-details").style.display = "block";
        });

        markers.push(marker);
      });
    }
  });
}

</script>


  </body>
</html>
