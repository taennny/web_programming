<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MeetMate - ìë£Œ ê³µìœ </title>
    <link rel="stylesheet" href="meetmate.css" />
    <script src="meetmate.js"></script>
    <style>
      .content {
        align-items: center;
        justify-content: center;
        flex: 1;
        padding: 48px;
        max-width: 800px;
        margin-right: 315px;
        min-height: calc(100vh - 80px);
      }
      .main-container {
        display: flex;
        justify-content: center;
      }
      .content h2 {
        text-align: center;
      }
      .material-card {
        background: white;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        padding: 16px;
        position: relative;
        display: flex;
        flex-direction: column;
        gap: 8px;
      }

      .card-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .card-title {
        font-weight: bold;
        font-size: 16px;
      }

      .delete-btn {
        background: none;
        border: none;
        font-size: 16px;
        cursor: pointer;
        color: #999;
      }

      .card-meta {
        font-size: 13px;
        color: #666;
      }

      .dday {
        font-weight: bold;
        color: #f36856;
      }

      .link-btn {
        text-align: center;
        display: inline-block;
        background-color: #f8f9fa;
        color: #333;
        text-decoration: none;
        padding: 8px 14px;
        border: 1px solid #ccc;
        border-radius: 6px;
        font-size: 13px;
        transition: all 0.2s ease;
      }

      .link-btn:hover {
        background-color: #e9ecef;
        border-color: #bbb;
        color: #222;
      }
      .card-title-wrapper {
        text-align: center;
      }

      .card-title {
        margin: 0;
        font-size: 16px;
        font-weight: bold;
      }

      .card-desc {
        font-size: 13px;
        color: #555;
        margin: 0;
      }
      .drive-upload-btn {
        padding: 4px 8px;
        font-size: 11px;
        font-weight: bold;
        border-radius: 6px;
        background-color: #f1f3f5;
        border: 1px solid #ccc;
        transition: all 0.2s;
        text-decoration: none;
        color: #333;
      }
      .drive-upload-btn:hover {
        background-color: #e2e6ea;
      }
    </style>
  </head>
  <body>
    <header>
      <h1>
        <a href="main-home.html" style="text-decoration: none; color: inherit"
          >MeetMate</a
        >
      </h1>
      <nav class="topnav">
        <ul>
          <li>
            <a href="group.html">ì¼ì • ì¡°ìœ¨</a>
          </li>
          <li>
            <a href="program.html">ì—­í•  ë¶„ë‹´</a>
          </li>
          <li>
            <a href="map.html">íšŒì˜ ì¥ì†Œ</a>
          </li>
          <li class="active">
            <a href="file-share.html">ìë£Œ ê³µìœ </a>
          </li>
          <li>
            <a href="group-result.html">ì „ì²´ ìš”ì•½</a>
          </li>
        </ul>
      </nav>
      <div class="top-buttons" id="auth-buttons">
        <!-- ë™ì ìœ¼ë¡œ ë‚´ìš© ì‚½ì…ë¨ -->
      </div>
    </header>

    <div class="main-container">
      <!-- content -->
      <div class="content">
        <h2>ìë£Œ ê³µìœ </h2>
        <a
          href="https://drive.google.com/drive/my-drive"
          target="_blank"
          class="primary drive-upload-btn"
          style="
            display: inline-flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 20px;
          "
        >
          <span style="font-size: 20px"></span>
          <span style="font-size: 15px">Google Driveì— ìë£Œ ì—…ë¡œë“œ</span>
        </a>

        <form
          id="uploadForm"
          class="form"
          style="
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
            margin-bottom: 24px;
          "
        >
          <input
            type="text"
            id="title"
            placeholder="ìë£Œ ì œëª©"
            required
            style="flex: 1 1 100%; padding: 10px"
          />
          <input
            type="date"
            id="deadline"
            required
            style="flex: 1 1 30%; padding: 10px"
          />
          <input
            type="url"
            id="link"
            placeholder="ê³µìœ  ë§í¬ (https://drive.google.com/...)"
            required
            style="flex: 1 1 65%; padding: 10px"
          />
          <input
            type="text"
            id="comment"
            placeholder="ìë£Œ ì„¤ëª… (ì„ íƒ)"
            style="flex: 1 1 100%; padding: 10px"
          />
          <button type="submit" class="primary" style="margin-top: 8px">
            ë“±ë¡
          </button>
        </form>

        <div
          id="fileList"
          style="
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 16px;
            max-height: 400px;
            overflow-y: auto;
            padding-right: 8px;
            padding-bottom: 8px;
          "
        ></div>
      </div>
      <!-- ì˜¤ë¥¸ìª½ ì‚¬ì´ë“œ ë°” -->
      <div class="side-panel">
        <div class="card">
          <div id="today-date">ğŸ“… ì˜¤ëŠ˜ ë‚ ì§œ: ...</div>
          <div id="current-time">ğŸ•’ í˜„ì¬ ì‹œê°„: ...</div>
        </div>
        <div class="card motivation">
          ğŸ©¶ ì˜¤ëŠ˜ë„ ì¢‹ì€ í•˜ë£¨ ë˜ì„¸ìš”!<br />í•¨ê»˜í•˜ëŠ” ì¼ì •ì€ ë” ì†Œì¤‘í•´ìš”.
        </div>
      </div>
    </div>
    <script>
      // D-DAY ê³„ì‚° í•¨ìˆ˜
      function getDdayLabel(deadlineStr) {
        const today = new Date();
        const deadline = new Date(deadlineStr);

        const todayDate = new Date(
          today.getFullYear(),
          today.getMonth(),
          today.getDate()
        );
        const deadlineDate = new Date(
          deadline.getFullYear(),
          deadline.getMonth(),
          deadline.getDate()
        );

        const diffTime = deadlineDate - todayDate;
        const diffDays = Math.round(diffTime / (1000 * 60 * 60 * 24));

        if (diffDays > 0) return `D-${diffDays}`;
        else if (diffDays === 0) return `D-DAY`;
        else return `D+${Math.abs(diffDays)}`;
      }

      const form = document.getElementById("uploadForm");
      const fileList = document.getElementById("fileList");

      // âœ… ì €ì¥ í‚¤ë¥¼ ì „ì²´ìš”ì•½ê³¼ ë§ì¶”ê¸° ìœ„í•´ fileShareë¡œ ë³€ê²½
      let files = JSON.parse(localStorage.getItem("fileShare") || "[]");

      function saveFiles() {
        localStorage.setItem("fileShare", JSON.stringify(files));
      }

      function renderFiles() {
        fileList.innerHTML = "";
        files.forEach((file, index) => {
          const ddayLabel = getDdayLabel(file.date); // âœ… ì†ì„±ëª… ë³€ê²½: deadline â†’ date
          const card = document.createElement("div");
          card.className = "material-card";
          card.innerHTML = `
              <div class="card-header">
                <div class="card-title-wrapper">
                  <h3 class="card-title">ğŸ—‚ ${file.title}</h3>
                </div>
                <button class="delete-btn" onclick="deleteFile(${index})">âŒ</button>
              </div>
              <p class="card-meta">ë§ˆê°: ${
                file.date
              } <span class="dday">(${ddayLabel})</span></p>
              <a href="${
                file.link
              }" target="_blank" class="link-btn">ğŸ”— Drive ë§í¬ ì—´ê¸°</a>
              <p class="card-desc">ğŸ“ ${file.desc || "ì„¤ëª… ì—†ìŒ"}</p>
            `;
          fileList.appendChild(card);
        });
      }

      window.deleteFile = function (i) {
        if (confirm("ì´ ìë£Œë¥¼ ì‚­ì œí• ê¹Œìš”?")) {
          files.splice(i, 1);
          saveFiles();
          renderFiles();
        }
      };

      form.addEventListener("submit", (e) => {
        e.preventDefault();
        const title = document.getElementById("title").value;
        const date = document.getElementById("deadline").value;
        const link = document.getElementById("link").value;
        const desc = document.getElementById("comment").value;

        // âœ… ì €ì¥ í˜•ì‹ ë§ì¶¤
        files.push({ title, date, link, desc });

        saveFiles();
        renderFiles();
        form.reset();
      });

      renderFiles();

      const username = localStorage.getItem("user");
      const topArea = document.getElementById("auth-buttons");

      if (username && username !== "null") {
        topArea.innerHTML = `
        <span>${username}ë‹˜ í™˜ì˜í•©ë‹ˆë‹¤</span>
        <button onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
      `;
      } else {
        topArea.innerHTML = `
        <button onclick="window.location.href='login.html'">ë¡œê·¸ì¸</button>
      `;
      }

      function logout() {
        localStorage.removeItem("user");
        location.reload();
      }
    </script>
  </body>
</html>
